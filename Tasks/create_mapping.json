# pipeline

PUT _ingest/pipeline/tasks_parameters
{
    "processors": [
        {
            "json": {
                "field": "taskparams"
            }
        },
        {
            "set": {
                "field": "taskparams.nGBPerJob",
                "value": "99999999",
                "if": "ctx.taskparams?.nGBPerJob == 'MAX'"
            }
        },
        {
            "set": {
                "field": "taskparams.newSite",
                "value": "True",
                "if": "ctx.taskparams?.newSite == true"
            }
        },
        {
            "set": {
                "field": "taskparams.newSite",
                "value": "False",
                "if": "ctx.taskparams?.newSite == false"
            }
        }
        
    ]
}

DELETE task_parameters-000001
PUT task_parameters-000001
{
    "settings": {
        "index.lifecycle.name": "task_parameters",
        "index.lifecycle.rollover_alias": "tasks_parameters_write"
    },
    "aliases": {
        "tasks_parameters_write": {
            "is_write_index": true
        }
    }
}

PUT task_parameters-000001/_doc/20000000
{}


curl -XPOST 'http: //atlas-kibana-dev.mwt2.org:9200/_template/tasks' -d '{ "template": "tasks*", "settings": { "number_of_shards": 5, "number_of_replicas": 1
},
"aliases": {
    "tasks": {}
},
"mappings": {
"task_data": {
    "_source": {
        "enabled": true
    },
    "properties": {
        "jeditaskid": {
            "type": "long"
        },
        "taskname": {
            "type": "keyword"
        },
        "status": {
            "type": "keyword"
        },
        "username": {
            "type": "keyword"
        },
        "reqid": {
            "type": "long"
        },
        "oldstatus": {
            "type": "keyword"
        },
        "cloud": {
            "type": "keyword"
        },
        "site": {
            "type": "keyword"
        },
        "prodsourcelabel": {
            "type": "keyword"
        },
        "workinggroup": {
            "type": "keyword"
        },
        "vo": {
            "type": "keyword"
        },
        "corecount": {
            "type": "long"
        },
        "tasktype": {
            "type": "keyword"
        },
        "processingtype": {
            "type": "keyword"
        },
        "taskpriority": {
            "type": "long"
        },
        "currentpriority": {
            "type": "long"
        },
        "architecture": {
            "type": "keyword"
        },
        "transuses": {
            "type": "keyword"
        },
        "transhome": {
            "type": "keyword"
        },
        "transpath": {
            "type": "keyword"
        },
        "lockedby": {
            "type": "keyword"
        },
        "termcondition": {
            "type": "keyword"
        },
        "splitrule": {
            "type": "keyword"
        },
        "walltime": {
            "type": "long"
        },
        "walltimeunit": {
            "type": "keyword"
        },
        "outdiskcount": {
            "type": "long"
        },
        "outdiskunit": {
            "type": "keyword"
        },
        "workdiskcount": {
            "type": "long"
        },
        "workdiskunit": {
            "type": "keyword"
        },
        "ramcount": {
            "type": "long"
        },
        "ramunit": {
            "type": "keyword"
        },
        "iointensity": {
            "type": "long"
        },
        "iointensityunit": {
            "type": "keyword"
        },
        "workqueue_id": {
            "type": "integer"
        },
        "progress": {
            "type": "integer"
        },
        "failurerate": {
            "type": "integer"
        },
        "errordialog": {
            "type": "keyword"
        },
        "countrygroup": {
            "type": "keyword"
        },
        "parent_tid": {
            "type": "long"
        },
        "eventservice": {
            "type": "integer"
        },
        "ticketid": {
            "type": "keyword"
        },
        "ticketsystemtype": {
            "type": "keyword"
        },
        "superstatus": {
            "type": "keyword"
        },
        "campaign": {
            "type": "keyword"
        },
        "mergeramcount": {
            "type": "long"
        },
        "mergeramunit": {
            "type": "keyword"
        },
        "mergewalltime": {
            "type": "long"
        },
        "mergewalltimeunit": {
            "type": "keyword"
        },
        "numthrottled": {
            "type": "integer"
        },
        "mergecorecount": {
            "type": "long"
        },
        "goal": {
            "type": "integer"
        },
        "cputime": {
            "type": "long"
        },
        "cputimeunit": {
            "type": "keyword"
        },
        "cpuefficiency": {
            "type": "integer"
        },
        "basewalltime": {
            "type": "long"
        },
        "amiflag_old": {
            "type": "keyword"
        },
        "amiflag": {
            "type": "integer"
        },
        "nucleus": {
            "type": "keyword"
        },
        "requesttype": {
            "type": "keyword"
        },
        "gshare": {
            "type": "keyword"
        },
        "resource_type": {
            "type": "keyword"
        },
        "baseramcount": {
            "type": "long"
        },
        "diskio": {
            "type": "long"
        },
        "diskiounit": {
            "type": "keyword"
        },
        "usejumbo": {
            "type": "keyword"
        },
        "lockedtime": {
            "type": "date"
        },
        "statechangetime": {
            "type": "date"
        },
        "throttledtime": {
            "type": "date"
        },
        "assessmenttime": {
            "type": "date"
        },
        "creationdate": {
            "type": "date"
        },
        "modificationtime": {
            "type": "date"
        },
        "starttime": {
            "type": "date"
        },
        "endtime": {
            "type": "date"
        },
        "frozentime": {
            "type": "date"
        },
        "rescuetime": {
            "type": "date"
        },
        "ttcrequested": {
            "type": "date"
        },
        "ttcpredicted": {
            "type": "date"
        },
        "ttcpredictiondate": {
            "type": "date"
        },
        "output_formats": {
            "type": "keyword"
        },
        "indexName": {
            "type": "keyword"
        }
    }
}
}
}'